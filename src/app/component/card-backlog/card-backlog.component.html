<div class="card backlog">
    <div class="backlog-container">
        <div class="indicator priority-{{backlogData.priorityName}}" [class.expanded]="expanded()"></div>
        <div class="backlog-inner-container">
            <span class="arrow-icon-container" (click)="expandWorkInside()"> <mat-icon class="arrow-icon">@if
                    (!expanded()){keyboard_arrow_right} @else {keyboard_arrow_down}</mat-icon>
            </span>


            <div (click)="openForm()" class="card-name">
                <span>{{backlogData.backlogName}}</span>
            </div>


            <div class="card-section">
                <span class="section-label">State</span>
                <div class="progress-bar-battery">
                    @for (item of backlogData.workStateCountList; track $index) {
                    <div class=" progress-fill-battery state-{{dataService.formatClassName(item.stateName)}}"
                        [matTooltip]="getTooltip(item.stateName,item.stateCount,item.percentage)"
                        [style.width.%]="item.percentage">
                    </div>
                    }
                </div>
            </div>

            <div class="card-section">
                <span class="section-label">Priority</span>
                <div class="card-status priority-{{backlogData.priorityName}}">
                    <span (click)="priorityPop.toggleVisibility()">{{backlogData.priorityName}}</span>
                </div>
                <app-pop-up-change [style.visibility]="" #priorityPop
                    (dataChange)="updateBacklogData('priority', $event)"
                    [popUpData]="{class: 'priority', current: { name: backlogData.priorityName, id: backlogData.priorityId} }">
                </app-pop-up-change>
            </div>


            <div class="card-section">
                <span class="section-label">Period</span>
                <div class="progress-bar" matTooltip="{{ periodPercentage()}}%">
                    <span class="date-label">{{ backlogData.startDate | date : "shortDate" }} - {{
                        backlogData.targetDate |
                        date
                        : "shortDate" }}</span>
                    <div class="progress-fill" [style.width.%]="periodPercentage()"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="container-work">
        <app-expandable-work-container (newWorkState)="doWhenNewWork($event)" [isExpanded]="expanded"
            [indicatorClass]="'priority-' + backlogData.priorityName" [workList]="workList"
            [backlogId]="backlogData.backlogId"></app-expandable-work-container>
    </div>
</div>