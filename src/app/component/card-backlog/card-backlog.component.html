<div class="card backlog">
    <div class="backlog-container">
        <div class="indicator priority-{{backlogData.priorityName}}"></div>
        <div class="backlog-inner-container">
            <span class="arrow-icon-container" (click)="expandWorkInside()"> <mat-icon class="arrow-icon">@if
                    (!expanded()){keyboard_arrow_right} @else {keyboard_arrow_down}</mat-icon>
            </span>


            <div (click)="openForm()" class="card-name">
                <span>{{backlogData.backlogName}}</span>
            </div>


            <div class="card-section">
                <span class="section-label">State</span>
                <div class="progress-bar-battery">
                    @for (item of backlogData.workStateCountList; track $index) {
                    <div class=" progress-fill-battery state-{{dataService.formatClassName(item.stateName)}}"
                        [matTooltip]="getTooltip(item.stateName,item.stateCount,item.percentage)"
                        [style.width.%]="item.percentage">
                    </div>
                    }


                </div>
            </div>

            <div class="card-section">
                <span class="section-label">Priority</span>
                <div class="card-status priority-{{backlogData.priorityName}}">
                    <span (click)="priorityPop.toggleVisibility()">{{backlogData.priorityName}}</span>
                </div>
                <app-pop-up-change #priorityPop (dataChange)="updateBacklogData('priority', $event)"
                    [popUpData]="{class: 'priority', current: { name: backlogData.priorityName, id: backlogData.priorityId} }">
                </app-pop-up-change>
            </div>


            <div class="card-section">
                <span class="section-label">Period</span>
                <div class="progress-bar" matTooltip="{{ periodPercentage()}}%">
                    <span class="date-label">{{ backlogData.startDate | date : "shortDate" }} - {{
                        backlogData.targetDate |
                        date
                        : "shortDate" }}</span>
                    <div class="progress-fill" [style.width.%]="periodPercentage()"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="container-work">
        <app-expandable-work-container (newWorkState)="doWhenNewWork($event)" [isExpanded]="expanded"
            [indicatorClass]="'priority-' + backlogData.priorityName" [workList]="workList"
            [backlogId]="backlogData.backlogId"></app-expandable-work-container>
    </div>
    <!-- <div>height:{{workChildContainerHeight()}} </div> -->
    <!-- <div class="child-wrapper" #workChildContainer [style.maxHeight.px]="workChildContainerHeight()"
        (mouseleave)="workHovered.set(false)" (mouseenter)="workHovered.set(true)">
        <div class="child-container">
            <div class="indicator-child priority-{{backlogData.priorityName}}"></div>
            <div class="work-list-container">
                <div class="work-header">
                    <span class="section-label name">FUNCTION</span>
                    <span class="section-label">TRACKER</span>
                    <span class="section-label">ACTIVITY</span>
                    <span class="section-label">STATE</span>
                    <span class="section-label">PRIORITY</span>
                    <span class="section-label">PERIOD</span>
                </div>


                @for (work of workList(); track $index) {
                <app-card-work [workData]="work"></app-card-work>
                }
                <app-card-work-new [class.empty]="!workList().length" [backlogData]="backlogData"
                    (newWork)="doWhenNewWork($event)"></app-card-work-new>

            </div>
        </div>
    </div> -->
</div>